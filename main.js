(()=>{"use strict";function e(e,t,n,o,r){var c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__title"),i=c.querySelector(".card__image"),u=c.querySelector(".card__delete-button"),s=c.querySelector(".card__like-button"),l=c.querySelector(".card__like-amount"),d=e.name,p=e.link,f=e._id,m=e.owner._id,v=e.likes,_=v.length;return a.textContent=d,i.src=p,i.alt=d,m===t?u.addEventListener("click",(function(){r(f,c)})):u.remove(),s.addEventListener("click",(function(e){return function(e,t,n,o){o(t,e.target,n,!!e.target.classList.contains("card__like-button_is-active"))}(e,f,l,n)})),i.addEventListener("click",(function(){return o(d,p)})),v.some((function(e){return e._id===t}))&&s.classList.add("card__like-button_is-active"),l.textContent=_||0,c}var t="popup_is-opened";function n(e){e.classList.add(t),e.addEventListener("keydown",r)}function o(e){e.classList.remove(t),e.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector("."+t))}function c(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove(n.inactiveButtonClass):t.classList.add(n.inactiveButtonClass)}function a(e,t,n){var o=e.querySelector(".".concat(t.name,"-input-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}function i(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){a(e,n,t)})),o.classList.add(t.inactiveButtonClass)}var u={baseUrl:"https://nomoreparties.co/v1/".concat("wff-cohort-26"),headers:{authorization:"3030b019-4537-4e11-8fa7-8b770ae8139c","Content-Type":"application/json"}};function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};switch(n){case"GET":return fetch("".concat(e.baseUrl,"/").concat(t),{headers:e.headers});case"POST":case"PATCH":return fetch("".concat(e.baseUrl,"/").concat(t),{method:n,headers:e.headers,body:JSON.stringify(o)});case"PUT":case"DELETE":return fetch("".concat(e.baseUrl,"/").concat(t),{method:n,headers:e.headers})}}function l(e,t,n,o){var r="cards/likes/"+e;o?s(u,r,"DELETE").then((function(e){if(e.ok){t.classList.remove("card__like-button_is-active");var o=Number(n.textContent);return o-=1,n.textContent=String(o),void console.log("Лайк успешно удалён")}return Promise.reject(e.status)})).catch((function(e){console.log("Ошибка: ".concat(e))})):s(u,r,"PUT").then((function(e){return e.ok?(console.log("Лайк успешно поставлен"),e.json()):Promise.reject(e.status)})).then((function(e){n.textContent=e.likes.length,t.classList.add("card__like-button_is-active")})).catch((function(e){console.log("Ошибка: ".concat(e))}))}function d(e,t){s(u,"cards/"+e,"DELETE").then((function(e){return e.ok?(t.remove(),void console.log("Карточка успешно удалена")):Promise.reject(e.status)})).catch((function(e){console.log("Ошибка: ".concat(e))}))}var p={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},f={nameSelector:".profile__title",descriptionSelector:".profile__description",avatarSelector:".profile__image"},m=document.querySelector(".content"),v=m.querySelector(".places__list"),_=m.querySelector(".profile__title"),y=m.querySelector(".profile__description"),S=m.querySelector(".profile__image"),g=document.querySelector(".profile__edit-button"),h=document.querySelector(".profile__add-button"),q=document.querySelector(".popup_type_edit"),k=document.forms["edit-profile"],b=q.querySelector("input[name='name']"),C=q.querySelector("input[name='description']"),E=document.querySelector(".popup_type_update-avatar"),L=document.forms["update-avatar"],x=E.querySelector("input[name='avatar-link']"),P=document.querySelector(".popup_type_new-card"),T=document.forms["new-place"],j=P.querySelector("input[name='place-name']"),w=P.querySelector("input[name='link']"),A=document.querySelector(".popup_type_image"),B=A.querySelector(".popup__image"),D=A.querySelector(".popup__caption");function U(e,t){var n=e.querySelector(".popup__button");switch(t){case"start":n.textContent+="...";break;case"end":n.textContent=n.textContent.replace("...","")}}function H(e){e.querySelector(".popup__close").addEventListener("click",(function(){return o(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&o(e)}))}function M(t,n,o,r,c){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"";switch(n){case"get":!function(e,t,n,o,r,c){Promise.all([s(u,"users/me"),s(u,"cards")]).then((function(e){return e.every((function(e){return e.ok}))?(console.log("Данные профиля и карточек успешно загружены с сервера"),Promise.all(e.map((function(e){return e.json()})))):Promise.reject(e.map((function(e){return e.status})))})).then((function(a){var i=a[0],u=a[1],s=i._id;document.querySelector(e.nameSelector).textContent=i.name,document.querySelector(e.descriptionSelector).textContent=i.about,document.querySelector(e.avatarSelector).style.backgroundImage="url(".concat(i.avatar,")"),u.forEach((function(e){var a=n(e,s,o,r,c);t.append(a)}))})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(a,t,e,o,r,c);break;case"post":!function(e,t,n,o,r,c){s(u,"cards","POST",{name:e.name,link:e.link}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){var a=e.owner._id,i=n(e,a,o,r,c);t.prepend(i),console.log("Карточка успешно добавлена")})).catch((function(e){console.log("Ошибка: ".concat(e))}))}({name:i,link:l},t,e,o,r,c)}}function N(e,t){B.src=t,D.textContent=e,B.alt=e,n(A)}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);c(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){c(n,o,t),function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.name,"-input-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,n,t.validationMessage)}(e,r,t)}))}))}(t,e)}))}(p),M(v,"get",l,N,d,f),g.addEventListener("click",(function(){b.value=_.textContent,C.value=y.textContent,i(q,p),n(q)})),h.addEventListener("click",(function(){i(P,p),T.reset(),n(P)})),S.addEventListener("click",(function(){i(E,p),L.reset(),n(E)})),k.addEventListener("submit",(function(e){var t;e.preventDefault(),_.textContent=b.value,y.textContent=C.value,U(e.target,"start"),t={name:b.value,about:C.value},s(u,"users/me","PATCH",{name:t.name,about:t.about}).then((function(e){return e.ok&&console("Данные профиля успешно сохранены"),Promise.reject(e.status)})).then((function(e){console.log(e)})).catch((function(e){console.log("Ошибка: ".concat(e))})),o(q),U(e.target,"end"),e.target.reset()})),T.addEventListener("submit",(function(e){e.preventDefault(),U(e.target,"start"),M(v,"post",l,N,d,f,j.value,w.value),o(P),U(e.target,"end"),e.target.reset()})),L.addEventListener("submit",(function(e){e.preventDefault(),U(e.target,"start"),function(e,t){s(u,"users/me/avatar","PATCH",{avatar:e}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).then((function(e){console.log(e.avatar),t.style.backgroundImage="url(".concat(e.avatar,")"),console.log("Аватар успешно добавлен")})).catch((function(e){console.log("Ошибка: ".concat(e))}))}(x.value,S),o(E),U(e.target,"end"),e.target.reset()})),H(q),H(P),H(A),H(E)})();